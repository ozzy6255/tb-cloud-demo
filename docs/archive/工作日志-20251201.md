# 工作日志 - 2025-12-01

**日期**: 2025-12-01
**工作阶段**: 字典工程终极核对 & 全量数据清洗

---

## ✅ 今天完成的工作

### 1. 产品字典深度修复 (人工 + 自动)
- **问题发现**:
    - `Product_Attribute_Mapping.csv` 中存在 76 条未匹配记录。
    - `珍藏级/优选级` 产品被错误映射到普通版。
    - 存在 `新天骄` vs `天骄`、`雅干红` vs `雅观干红` 等近似名称混淆。
    - TB 数据库中存在 83 个未匹配的年份/礼盒变体。
- **解决方案**:
    - 执行多轮 **"生成CSV -> 人工核对 -> 批量应用"** 的流程。
    - **合并**: 将 `新天骄`、`新飞腾` 等合并入主产品；将 `1545凌悦` 合并入 `1545`。
    - **忽略**: 建立了 `Sales_Ignore_List.csv`，将 145+ 个非产品条目（酒庄游、包材等）和 12 个特定非核心酒品（如 `11年马克西莫`）永久排除。
    - **新增**: 识别并添加了 `千禧干白` 等新产品。
- **结果**: **产品字典在 NC/TB/Sales/Production 四个数据库中的覆盖率均达到 100%**。

### 2. 经销商字典覆盖率验证
- **验证**:
    - NC / TB: 100% 覆盖。
    - Sales: 发现 `张宝权` 和 `王总` 两个遗漏。
- **处理**:
    - 查询发现两者三年销量分别为 34 瓶和 300 瓶，决定**不忽略**。
    - 将其作为 Master 经销商加入字典，确保 Sales 覆盖率达到 **100%**。

### 3. 全量数据清洗 (v2)
- **脚本升级**: `src/data_cleaning/clean_all_data_v2.py`
    - 集成了最新的字典逻辑。
    - 增加了对 `Ignore List` 的支持。
    - 优化了列名标准化（统一为 `Quantity`, `Amount`, `Order_Date`）。
- **执行**:
    - 生成了 `Cleaned_Sales_2022_2024.csv` (13.2万条)。
    - 生成了 `Cleaned_Production_2022_2024.csv` (1956条)。

### 4. 字典排序优化
- 编写 `scripts/sort_dictionaries.py`，将字典按“覆盖度”降序排列（4个数据库都有的排在最前），极大方便了后续的人工查阅。

---

## 📝 关键决策记录

1.  **白兰地处理**: 生产数据中只有通用的 `白兰地`，而销售/TB中有具体的 `VSOP`、`XO`。**决策**: 保持字典中的独立区分，不强行合并，未来通过属性字典进行统计。
2.  **忽略策略**: 凡是列入 `Sales_Ignore_List.csv` 的条目，在覆盖率检查时视为“已处理”，不再报错。

---

## 🎯 明天计划

1.  **经销商字典人工核实**: 用户将亲自审查 `Dealer_Dictionary_Master.csv`，确认是否存在重复公司或需要合并的条目。
2.  **经销商清洗**: 根据核实结果更新字典。
3.  **产销分析**: 待经销商字典封板后，正式开始业务分析。
